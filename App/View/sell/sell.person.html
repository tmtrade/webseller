<? require(ViewDir.'/header.html'); ?>
<style type="text/css">
    body,html{
        background-color: #ffffff !important;
    }
</style>
<div class="yzc-sell-main" style="">
    <!--左侧菜单-->
    <? require(ViewDir.'/left.html'); ?>
    <!--右侧主体部分-->
    <div class="sell-lf-main">
        <div class="comm-list-tit sell-by-brand w-cont">
            <h3 class="fl">商标出售 ><label>根据申请人出售</label></h3>
            <p class="fr">
                您还可以选择:<a href="/sell/number">根据申请号出售  </a>|<a href="/sell/document">根据文档出售</a>
            </p>
        </div>
        <div class="comm-search-bg">
            <div class="desi by-brand-search w-cont">
                <label>根据申请人出售</label>
                <input type="text" class="cir" />
                <a  class="cir sear-btn" id="serch-pel">立刻搜索</a>
                <!--当该商标失效-->
                <!--<a class="eff-brand hint-bg cir"><i></i>改商标已失效</a>-->
            </div>
            <div class="batch-cz fr w-cont">
                <a  class="cir sear-btn batch-pric">批量设置价格</a>
                <a  class="cir qx-btn batch-del">批量删除</a>
            </div>
        </div>
        <div id="has-data" style="display: none" class="comm-list-mess">
            <div class="comm-list-news blk  brand-list">
                <form id="submit_number">
                    <table class="list-mess-main">
                        <thead>
                        <tr class="tbl-tit">
                            <th>全选</th> <th>序号</th><th class="list-mess-pic-tit">商标图形</th> <th>商标号  </th> <th>商标名称</th><th>期望获得收益    </th><th>操作</th>
                        </tr>
                        </thead>
                        <tbody class="list-mess" id="list_body"></tbody>
                    </table>
                </form>
            </div>
            <p class="brand-data fr">当前共有 <span id="goods_num">0</span> 条商品数据 </p>
        </div>
        <!--未添加商标-->
        <div id="no-data" class="no-data">
            <h4>您还未添加商标</h4>
            <label>请先添加商标到出售列表</label>
        </div>
        <div class="amend-cont-all">
            <? if($userInfo['mobile']): ?>
            <!--联系人信息完整可以修改-->
            <div class="amend-cont cir">
                <label>联系电话：</label>
                <div class="cg-cont-tel">
                    <span class="contact_mobile"><?=$userInfo['mobile']?></span>
                </div>
                <label>联系人：</label>
                <div class="cg-cont-name">
                    <span class="contact_name"><?=$userInfo['name']?></span>
                </div>
                <div class="cg-tel">
                    <a href="javascript:;" class="xg_mobile">修改联系方式</a>
                </div>
            </div>
            <? else: ?>
            <!--联系人信息不完整可以添加-->
            <div class="amend-cont cir">
                <div class="incomp f-hidden">
                    <label>联系电话：</label>
                    <div class="cg-cont-tel">
                        <input type="text" class="cir blk c_tel" />
                    </div>
                    <label>联系人：</label>
                    <div class="cg-cont-name">
                        <input type="text" class="cir blk c_name" value=""/>
                    </div>
                    <div class="cg-tel">
                        <a class="cir sear-btn cg-sear">确定修改</a><a class="cir qx-btn cg-qx">取消</a>
                    </div>
                </div>
                <p class="cir blk inc-ts">请至少添加一条商标数据</p>
            </div>
            <? endif; ?>
            <a class="sub-btn cir" id="add_goods">
                提交商品
            </a>
        </div>
        <!--保存修改内容的隐藏域-->
        <div id="nicaicai" style="display: none">
            <!--显示内容-->
            <div class="cc1 ">
                <label>联系电话：</label>
                <div class="cg-cont-tel">
                    <span class="contact_mobile"><?=$userInfo['mobile']?></span>
                </div>
                <label>联系人：</label>
                <div class="cg-cont-name">
                    <span class="contact_name"><?=$userInfo['name']?></span>
                </div>
                <div class="cg-tel">
                    <a href="javascript:;" class="xg_mobile">修改联系方式</a>
                </div>
            </div>
            <!--修改框-->
            <div class="cc2">
                <div class="incomp f-hidden">
                    <label>联系电话：</label>
                    <div class="cg-cont-tel">
                        <input type="text" class="cir blk c_tel" />
                    </div>
                    <label>联系人：</label>
                    <div class="cg-cont-name">
                        <input type="text" class="cir blk c_name" value=""/>
                    </div>
                    <div class="cg-tel">
                        <a class="cir sear-btn cg-sear">确定修改</a><a class="cir qx-btn cg-qx">取消</a>
                    </div>
                    <p class="cir blk inc-ts" style="display: none">请至少添加一条商标数据</p>
                </div>
            </div>
        </div>
    </div>
</div>
<!--批量设置价格弹窗-->
<div class="price-cpm common-cpm-sty" id="pri-cont-main">
    <div class="common-cpm-top">
        <h3>批量设置价格</h3>
    </div>
    <div class="common-cpm-cent">
        <label>您现在可以将</label>
        <select class="cir blk">
            <option>勾选中的商标</option>
            <option>全部商标</option>
        </select>
        <label>统一设置为</label>
        <input class="cir blk" type="text" placeholder="请输入商品期望获益的价格"/>
        <label>元</label>
    </div>
    <!--<div class="common-cpm-sub">-->
        <!--<a class="layui-layer-close cir sear-btn batch-pric " href="javascript:;">确定</a>-->
        <!--<a class="cir qx-btn batch-del gb-cpm-btn layui-layer-close" href="javascript:;">关闭</a>-->
    <!--</div>-->
</div>
<!--申请人输入为空时 点击搜索时弹出选择申请人弹窗-->
<div class="price-cpm common-cpm-sty" id="pel-cont-main">
    <div class="common-cpm-top">
        <h3>请选择申请人</h3>
    </div>
    <div class="cpm-pel-cent">
        <label class="tit">根据您搜索的关键字,有以下 20 条申请人符合您的搜索要求，请选择</label>
        <table class="cir blk">
            <thead>
            <tr>
                <td class="com-name">公司名称</td>
                <td class="com-ope">操作</td>
            </tr>
            </thead>
            <tbody class="list-mess">
            <tr>
                <td class="com-name"><p>四川川投有限责任公司</p></td>
                <td class="com-ope">
                    <i class="sell-ico opera"></i>
                </td>
            </tr>
            <tr>
                <td class="com-name"><p>四川川投有限责任公司</p></td>
                <td class="com-ope">
                    <i class="sell-ico opera"></i>
                </td>
            </tr>
            <tr>
                <td class="com-name"><p>四川川投有限责任公司</p></td>
                <td class="com-ope">
                    <i class="sell-ico opera"></i>
                </td>
            </tr>
            </tbody>
        </table>
        <div class="cpm-pel-price cir">
            <input class="chi" type="checkbox"/>
            <label>我想把本次出售的商标获益统一设置为</label>
            <input class="blk cir" type="text" placeholder="请输入每条商品期望获益的价格"/>
        </div>
    </div>
    <!--<div class="common-cpm-sub">-->
        <!--<a class="cir sear-btn batch-pric layui-layer-close" href="javascript:;">确定</a>-->
        <!--<a class="cir qx-btn batch-del gb-cpm-btn layui-layer-close" href="javascript:;">关闭</a>-->
    <!--</div>-->
</div>
<script type="text/javascript">
    var p_tel = '';
    var p_name = '';
    $(function(){
        //输入框获得焦点隐藏提示
        $('.amend-cont-all').on('focus','input',function(){
            $('.inc-ts').hide();
        });
        //编辑联系人
        $('.amend-cont-all').on('click','.xg_mobile',function(){
            edit_mobile(1);
        });
        $('.amend-cont-all').on('click','.cg-qx',function(){
            edit_mobile(2);
        });
        $('.amend-cont-all').on('click','.cg-sear',function(){
            edit_mobile(3);
        });
        //删除列表框
        $('#list_body').on("click",".del-lis",function(){
            $(this).parent().parent().remove();
            $('#goods_num').text(function(i,v){
                return v-1;
            });
            check_table();
        });
        //添加商标事件
        $('#addSell').click(function(){
            var number = $.trim($('#add_number').val());
            if(number==''){
                layer.msg('请输入商标号', {
                    time: 1500
                });
                return false;
            }
            //检查列表中是否有此商标
            var numbers = $('#list_body .number');
            var tmp = '';
            var flag = true;
            numbers.each(function(i){
                tmp = $.trim($(this).text());
                if(tmp==number){
                    flag = false;
                    return false;
                }
            });
            if(!flag){
                layer.msg('该商标已在列表中', {
                    time: 1500
                });
                return false;
            }
            //提交到服务器检查
            $.post('/sell/getTminfo',{'number':number},function(data){
                if(data.code==0){
                    var html = '<tr>\
                            <td><input type="checkbox"/></td>\
                            <td>01</td>\
                            <td class="list-mess-pic">\
                            <a class="pic" href="javascript:;"><img src="'+data.img+'"></a>\
                            </td>\
                            <td class="number">'+number+'</td>\
                            <td>'+data.name+'</td>\
                            <td class="exp-ear">\
                            <input type="hidden" name="number[]" value="'+number+'">\
                            我期望获益<input type="text" name="price[]" placeholder="请填写底价" class="cir blk"/>元\
                            </td>\
                            <td class="dele">\
                            <a class="del-lis" href="javascript:;">删除</a>\
                            </td>\
                            </tr>';
                    $('#list_body').append(html);
                    $('#add_number').val('');//清空输入框
                    $('#goods_num').text(function(i,v){
                        return v-0+1;
                    });
                    check_table();
                }else{
                    layer.msg(data.msg, {
                        time: 1500
                    });
                }
            },'json');
        });
        //提交商品事件
        $('#add_goods').click(function(){
            var num = $('#goods_num').text();
            if(num>20){
                layer.msg('单次提交商标数不能大于20', {
                    time: 1500
                });
                return false;
            }
            //检查商标价格
            var prices = $('#list_body input[name*=price]');
            if(prices.length==0){
                layer.msg('请至少添加一条商标信息', {
                    time: 1500
                });
                return false;
            }
            var tmp = '';
            var flag = true;
            prices.each(function(i){
                tmp = $.trim($(this).val());
                if(!tmp){
                    flag = false;
                    return false;
                }
            });
            if(!flag){
                layer.msg('请填写底价', {
                    time: 1500
                });
                return false;
            }
            //序列化表单数据
            var data = $('#submit_number').serialize();
            //联系人信息
            var mobile = $('.amend-cont-all .contact_mobile').text();
            if(!isMobile(mobile)){
                layer.msg('手机号不正确', {
                    time: 1500
                });
                return false;
            }
            var name = $('.amend-cont-all .contact_name').text();
            if(!name){
                layer.msg('请输入联系人', {
                    time: 1500
                });
                return false;
            }
            if(!isName(name)){
                layer.msg('联系人为30个字符内的中文或英文', {
                    time: 1500
                });
                return false;
            }
            //组装联系人信息
            data += ('&mobile='+mobile+'&name='+name);
            //提交数据
            $.post('/sell/addNumber',data,function(dd){
                if(dd.code==0){
                    layer.msg('提交成功', {
                        time: 1500
                    });
                    location.reload();
                }else if(dd.code==1){
                    layer.msg(dd.msg, {
                        time: 1500
                    });
                }else{
                    //var msg = '出现错误, 请稍后再试';//线上
                    var msg = dd.msg;
                    layer.msg(dd.msg, {
                        time: 1500
                    });
                }
            },'json');
        });
        //批量设置价格
        $(".batch-pric").on("click",function(){
            layer.open({
                area:["640px","202"],
                btn: ['确定','关闭'],
                type: 1,
                title: false,
                closeBtn:1,
                shadeClose:false,
                content:$("#pri-cont-main")
            });
        });
        //批量删除；
        var oips=$(".list-mess tr td").find("input:checkbox");
        $(".batch-del").on("click",function(){
            oips.each(function(i){
                if($(oips[i]).attr("checked")=="checked"){
                    $(oips[i]).parent().parent().remove();
                }
            })
        });
    });
    //搜索框输入为空的时候 弹出请选择申请人弹窗
    var osinp;
    $("#serch-pel").on("click",function(){
        osinp=$(this).siblings("input").val();
        if(osinp==""){
            layer.open({
                area:["640px","202"],
                btn: ['确定','关闭'],
                type: 1,
                title: false,
                closeBtn:1,
                shadeClose: true, //开启遮罩关闭
                content:$("#pel-cont-main")
            });
        }
    });
    //检查表格中是否有内容
    function check_table(){
        var objs = $('#list_body tr').length;
        if(!objs){
            $('#has-data').hide();
            $('#no-data').show();
        }else{
            $('#no-data').hide();
            $('#has-data').show();
        }
    }
    //验证是否手机
    function isMobile(mobile){
        var mobilereg = /^(13[0-9]|14[0-9]|15[0-9]|17[0-9]|18[0-9])\d\d\d\d\d\d\d\d$/i;
        if(!mobilereg.test(mobile) || mobile.length!=11){
            return false;
        }else{
            return true;
        }
    }
    //编辑联系人
    function edit_mobile(type){
        var show1 = $('#nicaicai .cc1');
        var hide1 = $('#nicaicai .cc2');
        if(type==1){ //修改
            //保存原值
            p_tel = $('.amend-cont-all .contact_mobile').text();
            p_name = $('.amend-cont-all .contact_name').text();
            //赋值
            hide1.find('.c_tel').attr('value',p_tel);
            hide1.find('.c_name').attr('value',p_name)
            $('.amend-cont').html(hide1.html());
        }else if(type==2){//还原
            show1.find('.contact_mobile').text(p_tel);
            show1.find('.contact_name').text(p_name);
            $('.amend-cont').html(show1.html());
        }else{//确定
            var now_tel = $('.amend-cont-all .cg-cont-tel input').val();
            var now_name = $('.amend-cont-all .cg-cont-name input').val();
            if(isMobile(now_tel)){
                if(isName(now_name)){
                    show1.find('.contact_mobile').text(now_tel);
                    show1.find('.contact_name').text(now_name);
                    $('.amend-cont').html(show1.html());
                }else{
                    $('.inc-ts').html('请输入正确的联系人').show();
                }
            }else{
                $('.inc-ts').html('请输入正确的联系电话').show();
            }
        }
    }
    //验证联系人
    function isName(name){
        if(name.length>30){
            return false;
        }
        var reg = /[\u4E00-\u9FA5]*[A-Za-z]*/i;
        if(reg.test(name)){
            return true;
        }else{
            return false;
        }
    }
</script>
<? require(ViewDir.'/footer.html'); ?>